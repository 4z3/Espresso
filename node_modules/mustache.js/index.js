
var readFileSync = require('fs').readFileSync,
    writeFileSync = require('fs').writeFileSync,
    fileExists = require('path').exists,
    join = require('path').join;

var source = join(__dirname, '../../submodules/mustache.js/mustache.js');

var Mustache = eval(readFileSync(source.toString()) + '; Mustache');

var render = exports.render = Mustache.to_html;

exports.renderFile = function (filename, templateFilename, ctx, callback) {
  fileExists(filename, function (exists) {
    if (exists) {
      callback(new Error('File already exists: ' + filename));
    } else {
      var template = readFileSync(templateFilename).toString();
      var output = render(template, ctx);
      writeFileSync(filename, output);
      callback();
    };
  });
};
